# Early Stage Diabetes Risk Prediction

## Project Overview
A machine learning project to predict early-stage diabetes using patient clinical data. This project includes data preprocessing, model training, evaluation, and SHAP-based interpretability analysis.

- **Classification Task**: Identify significant predictors of early-stage diabetes risk among individuals.
- **Use Case**: Helps healthcare providers identify high-risk patients early and plan preventive interventions.
- **Target Variable**: `class` (1 = high risk / positive, 0 = low risk / negative)

---

## Dataset
**Source**: [UCI Early Stage Diabetes Risk Prediction Dataset](https://archive.ics.uci.edu/dataset/529/early+stage+diabetes+risk+prediction+dataset)  

- **Original file used**: `diabetes_data_upload.csv`  
- **Number of samples**: 520  
- **Number of features**: 17 clinical and demographic features  
- **Data format**: CSV  

**Features include**:
- Demographics: Age, Gender  
- Clinical: Polyuria, Polydipsia, sudden weight loss, weakness, polyphagia, Genital thrush, visual blurring, itching, irritability, delayed healing, partial paresis, muscle stiffness, alopecia, obesity  

**Target**: `class` indicating early-stage diabetes risk

---

## Project Structure

```

early_stage_diabetes/
├── data/
│   ├── raw/diabetes_data_upload.csv       # Original raw dataset
│   └── processed/processed.csv           # Cleaned & preprocessed dataset
│   └── processed/raw_loaded.csv
├── src/                                  # Source scripts
│   ├── data.py                           # Load raw data
│   ├── preprocess.py                     # Data cleaning, encoding, and imputation
│   ├── modeling.py                       # Model training and evaluation
│   ├── evaluate.py                        # Final evaluation report
│   └── shap_analysis.py                  # SHAP feature importance
├── figures/                              # Figures generated by pipeline
│   ├── model_compare_auc.png
│   ├── shap_summary_beeswarm.png
│   └── shap_feature_importance.png
├── models/
│   └── best_model.joblib                  # Saved trained model
├── notebooks/                             # Optional interactive analysis
│   ├── eda.ipynb
│   ├── model_exploration.ipynb
│   └── shap_exploration.ipynb
├── reports/
│   └── evaluation.txt                     # Model evaluation report
├── environment.yml                        # Conda environment specification
├── run.sh                                 # Full pipeline execution script
├── requirements.txt 
└── README.md                              # This file


````

---

## Environment Setup
**Conda environment name**: `dsi_participant`  

**Create the environment**:
```bash
conda env create -f environment.yml
conda activate dsi_participant
````

**Dependencies include**:

* Python 3.10
* Pandas, NumPy, Scikit-learn, Matplotlib, Seaborn
* XGBoost, SHAP, TensorFlow, Missingno, Fancyimpute
* Jupyter and IPython kernel support

> All dependencies are listed in `environment.yml` to ensure reproducibility.

---

## Project Workflow

### 1. Load Raw Data

* Script: `src/data.py`
* Reads the raw CSV from `data/raw/` and writes a timestamped processed copy to `data/processed/raw_loaded.csv`.
* Usage:

```bash
python src/data.py --input data/raw/diabetes_data_upload.csv --out data/processed/raw_loaded.csv
```

### 2. Data Preprocessing

* Script: `src/preprocess.py`
* Steps:

  * Convert categorical 1/2 features to binary 1/0
  * Encode `Gender` to `gender_M` (Male=1, Female=0)
  * Encode target `class` to 0/1
  * Impute missing values: Age with median, others with mode
* Outputs `data/processed/processed.csv`

```bash
python src/preprocess.py --input data/processed/raw_loaded.csv --out data/processed/processed.csv
```

> **Note**: To avoid future warnings in pandas 3.0, use `df['Age'] = df['Age'].fillna(median_age)` instead of inplace.

### 3. Model Training

* Script: `src/modeling.py`

* Models trained:

  1. Logistic Regression
  2. Random Forest Classifier
  3. HistGradientBoosting Classifier

* Evaluation metrics on test set: ROC AUC, precision, recall, F1-score, confusion matrix

* Saves the **best model** (by ROC AUC) to `models/best_model.joblib`

* Saves comparison figure: `figures/model_compare_auc.png`

```bash
python src/modeling.py --input data/processed/processed.csv --out models/best_model.joblib --figdir figures
```

### 4. Model Evaluation

* Script: `src/evaluate.py`
* Loads saved model and evaluates test set metrics
* Saves results to `reports/evaluation.txt`

```bash
python src/evaluate.py --model models/best_model.joblib --input data/processed/processed.csv --out reports/evaluation.txt
```

### 5. Explainability with SHAP

* Script: `src/shap_analysis.py`
* Generates feature importance plots:

  * `figures/shap_summary_beeswarm.png`
  * `figures/shap_feature_importance.png`

```bash
python src/shap_analysis.py --model models/best_model.joblib --input data/processed/processed.csv --figdir figures
```

### 6. Full Pipeline

* Bash: `bash run.sh`
* Executes all steps in order from raw data to evaluation and SHAP analysis

---

## Key Results

* **Best model:** Random Forest Classifier  
* **ROC AUC:** 0.9898  
* **Precision:** 0.9830  
* **Recall:** 0.9063  
* **F1-score:** 0.9431  
* **Confusion Matrix:**  [[39, 1], [6, 58]] 

Other model performances for reference:

| Model               | ROC AUC  | Precision | Recall  | F1-score |
|---------------------|----------|-----------|---------|----------|
| Logistic Regression | 0.9703   | 0.9298    | 0.8281  | 0.8760   |
| HistGradientBoosting| 0.9879   | 0.9538    | 0.9688  | 0.9612   |

**Top predictors** (via SHAP):

1. Polyuria
2. Polydipsia
3. Sudden weight loss
4. Partial paresis
5. Polyphagia

> SHAP visualizations are saved in `figures/shap_summary_beeswarm.png` and `figures/shap_feature_importance.png`

> **Note**: Perfect metrics on this small dataset may indicate potential overfitting. Future work could include cross-validation and larger datasets.

---

## Reproducibility & Team Workflow

* `environment.yml` ensures **consistent Python environment** across machines
* Git workflow:

  * Feature branches created for each task: EDA, Modeling, SHAP
  * Pull Requests simulate collaborative team contribution
  * Commits clearly document preprocessing, modeling, evaluation
* `run.sh` allows **end-to-end reproducible execution**

---

## Business Impact

* Early detection of diabetes risk allows **proactive healthcare interventions**
* Top features identified by SHAP inform **clinician focus areas**
* Model evaluation ensures **robust predictions** for real-world deployment

---
